<!doctype html>
<html lang="en">
<head>
    <meta name="keywords" content="甜爱，SweetLove,甜品，甜点，生日蛋糕，冰淇淋，冰品"/>
    <meta name="description" content="甜爱网上商城是专注于甜品销售、进口的网站，各种甜品、甜点齐全，还有解暑的各种冰品任顾客挑选，让他们感受到爱的温馨。">
    <meta charset="utf-8">
    <title>我的甜品，你的爱~</title>
    <link rel="shortcut icon" href="images/logo_01.png">
    <link rel="stylesheet" href="css/shoppingcar.css">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/carts.css">

</head>

<body>
<!--页头-->
<div id="headCon">
    <div>
        <p>我的甜品 你的爱~</p>
        <ol>
            <li><a href="login.html">请登录</a></li>
            <li><a href="register.html">注册</a></li>
            <a href="order.html">我的订单</a>
            <!--<a href="#" class="shoppingCar">
            	<i></i>
            	<span>购物车（0）</span>
            </a>-->
        </ol>
    </div>
    <ul>
        <a href="index.html">
            <li></li>
        </a>
        <p>我的购物车</p>
        <ol>
            <li>
                <div class="my"><img src="img/shopcar_08.png"></div>
                <p class="red">我的购物车</p>
            </li>
            <li>
                <div class="order"><img src="img/shopcar_03.png"></div>
                <p>确认订单</p>
            </li>
            <li class="pay">
                <div class="pay"><img src="img/shopcar_11.png"></div>
                <p>支付</p>
            </li>
            <li class="bingo">
                <div class="bingo"><img src="img/shopcar_05.png"></div>
                <p>完成</p>
            </li>
        </ol>
    </ul>
</div>
<!--内容-->
<div id="contentCon">
    <ul>
        <li>
            <p>我的商品（5）</p>
            <span></span>
        </li>
        <p>优惠（2）</p>
    </ul>
    <section class="cartMain">
        <div class="cartMain_hd">
            <ul class="order_lists cartTop">
                <li class="list_chk">
                    <!--所有商品全选-->
                    <input type="checkbox" id="all" class="whole_check">
                    <label for="all"></label>
                    全选
                </li>
                <li class="list_con">商品信息</li>
                <li class="list_info">商品参数</li>
                <li class="list_price">单价（元）</li>
                <li class="list_amount">数量</li>
                <li class="list_sum">小计（元）</li>
                <li class="list_op">操作</li>
            </ul>
        </div>

        <!--        <div class="cartBox">-->
        <!--            <div class="shop_info">-->
        <!--                &lt;!&ndash;<div class="all_check">-->
        <!--                    &lt;!&ndash;店铺全选&ndash;&gt;-->
        <!--                    &lt;!&ndash;<input type="checkbox" id="shop_a" class="shopChoice">-->
        <!--                    <label for="shop_a" class="shop"></label>-->
        <!--                </div>&ndash;&gt;-->
        <!--                &lt;!&ndash;<div class="shop_name">-->
        <!--                    店铺：<a href="javascript:;">搜猎人艺术生活</a>-->
        <!--                </div>&ndash;&gt;-->
        <!--            </div>-->
        <!--            <div class="order_content">-->
        <!--                <ul class="order_lists">-->
        <!--                    <li class="list_chk">-->
        <!--                        <input type="checkbox" id="checkbox_2" class="son_check">-->
        <!--                        <label for="checkbox_2"></label>-->
        <!--                    </li>-->
        <!--                    <li class="list_con">-->
        <!--                        <div class="list_img"><a href="javascript:;"><img src="img/buy_03.jpg" alt=""></a></div>-->
        <!--                        <div class="list_text"><a href="javascript:;">东方既白<br>2017新品&nbsp;&nbsp;冰淇淋+小蛋糕</a></div>-->
        <!--                    </li>-->
        <!--                    <li class="list_info">-->
        <!--                        <p>净含量：250克</p>-->
        <!--                        <p>规&nbsp;&nbsp;&nbsp;&nbsp;格：中杯</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_price">-->
        <!--                        <p class="price">￥30.00</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_amount">-->
        <!--                        <div class="amount_box">-->
        <!--                            <a href="javascript:;" class="reduce reSty">-</a>-->
        <!--                            <input type="text" value="1" class="sum">-->
        <!--                            <a href="javascript:;" class="plus">+</a>-->
        <!--                        </div>-->
        <!--                    </li>-->
        <!--                    <li class="list_sum">-->
        <!--                        <p class="sum_price">￥30.00</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_op">-->
        <!--                        <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>-->
        <!--                    </li>-->
        <!--                </ul>-->
        <!--                <ul class="order_lists">-->
        <!--                    <li class="list_chk">-->
        <!--                        <input type="checkbox" id="checkbox_3" class="son_check">-->
        <!--                        <label for="checkbox_3"></label>-->
        <!--                    </li>-->
        <!--                    <li class="list_con">-->
        <!--                        <div class="list_img"><a href="javascript:;"><img src="img/buy_06.jpg" alt=""></a></div>-->
        <!--                        <div class="list_text"><a href="javascript:;">左岸<br>玫瑰花浪漫蛋糕</a></div>-->
        <!--                    </li>-->
        <!--                    <li class="list_info">-->
        <!--                        <p>净含量：500克</p>-->
        <!--                        <p>尺&nbsp;&nbsp;&nbsp;&nbsp;寸：6寸</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_price">-->
        <!--                        <p class="price">￥30.00</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_amount">-->
        <!--                        <div class="amount_box">-->
        <!--                            <a href="javascript:;" class="reduce reSty">-</a>-->
        <!--                            <input type="text" value="1" class="sum">-->
        <!--                            <a href="javascript:;" class="plus">+</a>-->
        <!--                        </div>-->
        <!--                    </li>-->
        <!--                    <li class="list_sum">-->
        <!--                        <p class="sum_price">￥30.00</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_op">-->
        <!--                        <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>-->
        <!--                    </li>-->
        <!--                </ul>-->
        <!--                <ul class="order_lists">-->
        <!--                    <li class="list_chk">-->
        <!--                        <input type="checkbox" id="checkbox_6" class="son_check">-->
        <!--                        <label for="checkbox_6"></label>-->
        <!--                    </li>-->
        <!--                    <li class="list_con">-->
        <!--                        <div class="list_img"><a href="javascript:;"><img src="img/buy_08.jpg" alt=""></a></div>-->
        <!--                        <div class="list_text"><a href="javascript:;">爱礼帝斯<br>2017新品&nbsp;&nbsp;可爱小动物曲奇</a></div>-->
        <!--                    </li>-->
        <!--                    <li class="list_info">-->
        <!--                        <p>净含量：250克</p>-->
        <!--                        <p>规&nbsp;&nbsp;&nbsp;&nbsp;格：5包</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_price">-->
        <!--                        <p class="price">￥50.00</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_amount">-->
        <!--                        <div class="amount_box">-->
        <!--                            <a href="javascript:;" class="reduce reSty">-</a>-->
        <!--                            <input type="text" value="1" class="sum">-->
        <!--                            <a href="javascript:;" class="plus">+</a>-->
        <!--                        </div>-->
        <!--                    </li>-->
        <!--                    <li class="list_sum">-->
        <!--                        <p class="sum_price">￥50.00</p>-->
        <!--                    </li>-->
        <!--                    <li class="list_op">-->
        <!--                        <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>-->
        <!--                    </li>-->
        <!--                </ul>-->
        <!--            </div>-->
        <!--        </div>-->

        <div class="cartBox">
            <!--            <div class="shop_info">-->
            <!--                <div class="all_check">-->
            <!--                    &lt;!&ndash;店铺全选&ndash;&gt;-->
            <!--                    <input type="checkbox" id="shop_b" class="shopChoice">-->
            <!--                    <label for="shop_b" class="shop"></label>-->
            <!--                </div>-->
            <!--                <div class="shop_name">-->
            <!--                    店铺：<a href="javascript:;">卷卷旗舰店</a>-->
            <!--                </div>-->
            <!--            </div>-->
            <div class="order_content" id="cart_content">
                <!--                <ul class="order_lists">-->
                <!--                    <li class="list_chk">-->
                <!--                        <input type="checkbox" id="checkbox_4" class="son_check">-->
                <!--                        <label for="checkbox_4"></label>-->
                <!--                    </li>-->
                <!--                    <li class="list_con">-->
                <!--                        <div class="list_img"><a href="javascript:;"><img src="img/buy_11.jpg" alt=""></a></div>-->
                <!--                        <div class="list_text"><a href="javascript:;">许留山<br>进口土耳其软糖</a></div>-->
                <!--                    </li>-->
                <!--                    <li class="list_info">-->
                <!--                        <p>净含量：100克</p>-->
                <!--                        <p>规&nbsp;&nbsp;&nbsp;&nbsp;格：1包</p>-->
                <!--                    </li>-->
                <!--                    <li class="list_price">-->
                <!--                        <p class="price">￥80.00</p>-->
                <!--                    </li>-->
                <!--                    <li class="list_amount">-->
                <!--                        <div class="amount_box">-->
                <!--                            <a href="javascript:;" class="reduce reSty">-</a>-->
                <!--                            <input type="text" value="1" class="sum">-->
                <!--                            <a href="javascript:;" class="plus">+</a>-->
                <!--                        </div>-->
                <!--                    </li>-->
                <!--                    <li class="list_sum">-->
                <!--                        <p class="sum_price">￥80.00</p>-->
                <!--                    </li>-->
                <!--                    <li class="list_op">-->
                <!--                        <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>-->
                <!--                    </li>-->
                <!--                </ul>-->
                <!--                <ul class="order_lists">-->
                <!--                    <li class="list_chk">-->
                <!--                        <input type="checkbox" id="checkbox_5" class="son_check">-->
                <!--                        <label for="checkbox_5"></label>-->
                <!--                    </li>-->
                <!--                    <li class="list_con">-->
                <!--                        <div class="list_img"><a href="javascript:;"><img src="img/buy_15.jpg" alt=""></a></div>-->
                <!--                        <div class="list_text"><a href="javascript:;">卡蜜儿<br>小杏仁芝麻饼干</a></div>-->
                <!--                    </li>-->
                <!--                    <li class="list_info">-->
                <!--                        <p>净含量：250克</p>-->
                <!--                        <p>规&nbsp;&nbsp;&nbsp;&nbsp;格：1包</p>-->
                <!--                    </li>-->
                <!--                    <li class="list_price">-->
                <!--                        <p class="price">￥20.00</p>-->
                <!--                    </li>-->
                <!--                    <li class="list_amount">-->
                <!--                        <div class="amount_box">-->
                <!--                            <a href="javascript:;" class="reduce reSty">-</a>-->
                <!--                            <input type="text" value="1" class="sum">-->
                <!--                            <a href="javascript:;" class="plus">+</a>-->
                <!--                        </div>-->
                <!--                    </li>-->
                <!--                    <li class="list_sum">-->
                <!--                        <p class="sum_price">￥20.00</p>-->
                <!--                    </li>-->
                <!--                    <li class="list_op">-->
                <!--                        <p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>-->
                <!--                    </li>-->
                <!--                </ul>-->
            </div>
        </div>
        <!--底部-->
        <div class="bar-wrapper">
            <div class="bar-right">
                <div class="piece">已选商品<strong class="piece_num">0</strong>件</div>
                <div class="totalMoney">共计: <strong class="total_text">0.00</strong></div>
                <div class="calBtn"><a href="pay.html" href="javascript:;">结算</a></div>
            </div>
        </div>
    </section>
    <section class="model_bg"></section>
    <section class="my_model">
        <p class="title">删除宝贝<span class="closeModel">X</span></p>
        <p>您确认要删除该宝贝吗？</p>
        <div class="opBtn"><a href="javascript:;" class="dialog-sure">确定</a><a href="javascript:;" class="dialog-close">关闭</a>
        </div>
    </section>
    <script src="js/jquery-1.10.2_2.js"></script>
    <script src="js/carts.js"></script>
    <script src="js/common.js"></script>
</div>
<!--页脚-->
<div id="footCon">
    <ul>
        <li>
            <div class="cold"></div>
            <span></span>
            <ol>
                <h2>18小时低温</h2>
                <p>全程冷链配送</p>
            </ol>
        </li>
        <li>
            <div class="wuxiu"></div>
            <span></span>
            <ol>
                <h2>7*24小时营业</h2>
                <p>全年无休</p>
            </ol>
        </li>
        <li>
            <div class="baoyou"></div>
            <span></span>
            <ol>
                <h2>满88包邮</h2>
                <p>次日送达</p>
            </ol>
        </li>
    </ul>
    <ol>
        <li>
            <i></i>
            <a href="index.html">www.sweetlove.com</a>
            <div>
                <a href="http://www.weibo.com" class="weibo"></a>
                <a href="http://wx.qq.com" class="weixin"></a>
            </div>
        </li>
        <ul>
            <li class="text01">
                <p>关于甜爱</p>
                <span></span>
                <a href="#">媒体报道</a>
                <a href="#">知识产权</a>
                <a href="#">加入我们</a>
            </li>
            <li>
                <p>帮助中心</p>
                <span></span>
                <a href="#">购物指南</a>
                <a href="#">订单管理</a>
                <a href="#">常见问题</a>
            </li>
            <li>
                <p>服务支持</p>
                <span></span>
                <a href="#">服务保障</a>
                <a href="#">用户协议</a>
                <a href="#">售后服务</a>
            </li>
            <li>
                <p>商业合作</p>
                <span></span>
                <a href="#">集合采购</a>
                <a href="#">品牌合作</a>
                <a href="#">媒体合作</a>
            </li>
        </ul>
        <div>
            <p>联系我们</p>
            <h2>400-8888-000</h2>
            <span>24小时服务热线</span>
            <a href="#">在线客服</a>
        </div>
    </ol>
    <div></div>
    <li>
        <p>Copyright © 2016 sweetlove.com Inc.All Rights Reserved. 北京甜爱食品有限公司</p>
        <span>版权所有 京ICP备14049645号-1 增值电信业务经营许可证：京ICP证160100号</span>
    </li>
</div>
</body>
<!-- 修改 购物车内容 -->
<script>
    $(function () {
        // 截取地址栏的 userId
        let userId = getQueryString("userId");
        // 展示购物车
        showCart(1);
    });

    // 展示购物车的方法
    function showCart(userId) {
        $(function () {
            // 定义 url
            let url = 'http://localhost:8080/cakeshop/cart/showCart';
            // 参数
            let data = {
                userId: userId
            };
            $.ajax({
                url: url,
                data: data,
                type: "GET",

                success: function (_data) {
                    // 判断状态
                    if (_data.status === 20000 && _data.message === "success") {
                        let data = _data.data;
                        if (data != null) {
                            if (data.status === 20000 && data.message === "success") {
                                // 购物车信息
                                let carts = data.data;
                                for (let i = 0; i < carts.length; i++) {
                                    // 更新数据，遍历
                                    $("#cart_content")
                                        .append(
                                            // 每个 ul 代表一个购物车
                                            $("<ul>")
                                                .addClass("order_lists")
                                                // 复选框
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_chk")
                                                        .append(
                                                            $("<input>")
                                                                .addClass("son_check")
                                                                .attr("type", "checkbox")
                                                                .attr("name", "product")
                                                                .attr("id", "checkbox_" + (i))
                                                        )
                                                        .append(
                                                            $("<label>")
                                                                .attr("for", "checkbox_" + (i))
                                                        )
                                                )
                                                // 图片，商品信息
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_con")
                                                        // 图片
                                                        .append(
                                                            $("<div>")
                                                                .addClass("list_img")
                                                                .append(
                                                                    $("<a>")
                                                                        .attr("href", "xiangqing.html?productId=" + carts[i].productId)
                                                                        .append(
                                                                            $("<img>")
                                                                                .attr("src", carts[i].productPic)
                                                                                .attr("alt", "图片挂了")
                                                                        )
                                                                )
                                                        )
                                                        // 商品信息
                                                        .append(
                                                            $("<div>")
                                                                .addClass("list_text")
                                                                .append(
                                                                    $("<a>")
                                                                        .attr("href", "xiangqing.html?productId=" + carts[i].productId)
                                                                        .text(carts[i].productName)
                                                                        .append(
                                                                            $("<br>")
                                                                        )
                                                                )
                                                                .append(
                                                                    $("<a>")
                                                                        .attr("href", "xiangqing.html?productId=" + carts[i].productId)
                                                                        .text(carts[i].productAttr)
                                                                )
                                                        )
                                                )
                                                // 商品参数
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_info")
                                                        .append(
                                                            $("<p>")
                                                                .text("尺 寸：")
                                                                .append(carts[i].productSize)
                                                        )
                                                )
                                                // 单价
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_price")
                                                        .append(
                                                            $("<p>")
                                                                .addClass("price")
                                                                .text("￥" + carts[i].productPrice)
                                                        )
                                                )
                                                // 数量
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_amount")
                                                        .append(
                                                            $("<div>")
                                                                .addClass("amount_box")
                                                                // - 减数量
                                                                .append(
                                                                    $("<a>")
                                                                        .addClass("reduce")
                                                                        .addClass("reSty")
                                                                        .attr("onclick", "subtract(" + carts[i].cartId + "," + carts[i].userId + "," + carts[i].productQuantity + ")")
                                                                        .text("-")
                                                                )
                                                                // 数量
                                                                .append(
                                                                    $("<input>")
                                                                        .addClass("sum")
                                                                        .attr("type", "text")
                                                                        .attr("value", carts[i].productQuantity)
                                                                    // 失去焦点事件
                                                                    // .attr("onBlur", "updateQuantity(" + carts[i].cartId + "," + carts[i].userId + ")")
                                                                )
                                                                // + 加数量
                                                                .append(
                                                                    $("<a>")
                                                                        .addClass("plus")
                                                                        .attr("onclick", "add(" + carts[i].cartId + "," + carts[i].userId + "," + carts[i].productQuantity + ")")
                                                                        .text("+")
                                                                )
                                                        )
                                                )
                                                // 总价
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_sum")
                                                        .append(
                                                            $("<p>")
                                                                .addClass("sum_price")
                                                                // toFixed(2)保留两位小数
                                                                .text("￥" + (carts[i].productPrice * carts[i].productQuantity).toFixed(2))
                                                        )
                                                )
                                                // 操作
                                                .append(
                                                    $("<li>")
                                                        .addClass("list_op")
                                                        .append(
                                                            $("<button>")
                                                                .addClass("del")
                                                                .text("移除商品")
                                                                .attr("onclick", "deleteCart(" + carts[i].cartId + "," + carts[i].userId + ")")
                                                        )
                                                )
                                        )
                                }
                            }
                        }
                    }
                }
            })
        })
    }

    // 减数量方法
    function subtract(_cartId, _userId, _num) {
        $(function () {
            // 判断数量是否正常
            if (_num <= 1) {
                alert("数量最小为 1，操作失败");
                // 终止方法
                return false;
            }
            // url
            let url = "http://localhost:8080/cakeshop/cart/updateCart";
            // 参数
            let data = {
                "cartId": _cartId,
                "quantity": _num - 1
            };
            // 修改
            if (confirm("确认减少数量吗？")) {
                $.ajax({
                    url: url,
                    data: data,
                    type: "POST",

                    success: function (_data) {
                        // 判断状态
                        if (_data.status === 20000 && _data.message === "success") {
                            // 取数据
                            let data = _data.data;
                            // 判断
                            if (data != null) {
                                if (data.status === 20000 && data.message === "success") {
                                    alert("成功修改" + data.data + "条数据");
                                    // 清空购物车信息
                                    $("#cart_content").empty();
                                    // 重新展示购物车信息
                                    showCart(_userId);
                                }
                            } else {
                                alert("修改失败");
                            }
                        } else {
                            alert("修改失败");
                        }
                    }
                })
            }
        })
    }

    // // 失去焦点事件时修改数量
    // function updateQuantity(_cartId, _userId) {
    //     $(function () {
    //         // 判断数量是否正常
    //         if (_num < 1) {
    //             alert("数量最小为 1，操作失败");
    //             // 终止方法
    //             return false;
    //         }
    //         // url
    //         let url = "http://localhost:8080/cakeshop/cart/updateCart";
    //         // 参数
    //         let data = {
    //             "cartId": _cartId,
    //             "quantity": _num
    //         };
    //         // 修改
    //         if (confirm("确认修改数量吗？")) {
    //             $.ajax({
    //                 url: url,
    //                 data: data,
    //                 type: "POST",
    //
    //                 success: function (_data) {
    //                     // 判断状态
    //                     if (_data.status === 20000 && _data.message === "success") {
    //                         // 取数据
    //                         let data = _data.data;
    //                         // 判断
    //                         if (data != null) {
    //                             if (data.status === 20000 && data.message === "success") {
    //                                 alert("成功修改" + data.data + "条数据");
    //                                 // 清空购物车信息
    //                                 $("#cart_content").empty();
    //                                 // 重新展示购物车信息
    //                                 showCart(_userId);
    //                             }
    //                         } else {
    //                             alert("修改失败");
    //                         }
    //                     } else {
    //                         alert("修改失败");
    //                     }
    //                 }
    //             })
    //         }
    //     })
    // }

    // 加数量方法
    function add(_cartId, _userId, _num) {
        $(function () {
            // url
            let url = "http://localhost:8080/cakeshop/cart/updateCart";
            // 参数
            let data = {
                "cartId": _cartId,
                "quantity": _num + 1
            };
            // 修改
            if (confirm("确认添加数量吗？")) {
                $.ajax({
                    url: url,
                    data: data,
                    type: "POST",

                    success: function (_data) {
                        // 判断状态
                        if (_data.status === 20000 && _data.message === "success") {
                            // 取数据
                            let data = _data.data;
                            // 判断
                            if (data != null) {
                                if (data.status === 20000 && data.message === "success") {
                                    alert("成功修改" + data.data + "条数据");
                                    // 清空购物车信息
                                    $("#cart_content").empty();
                                    // 重新展示购物车信息
                                    showCart(_userId);
                                } else {
                                    alert("库存不足");
                                }
                            } else {
                                alert("修改失败");
                            }
                        } else {
                            alert("修改失败");
                        }
                    }
                })
            }
        })
    }

    // 移除购物车
    function deleteCart(_cartId, _userId) {
        $(function () {
            // url
            let url = "http://localhost:8080/cakeshop/cart/deleteCart";
            // 参数
            let data = {
                "cartId": _cartId,
            };
            // 修改
            if (confirm("确认移除该商品吗？")) {
                $.ajax({
                    url: url,
                    data: data,
                    type: "POST",

                    success: function (_data) {
                        // 判断状态
                        if (_data.status === 20000 && _data.message === "success") {
                            // 取数据
                            let data = _data.data;
                            // 判断
                            if (data != null) {
                                if (data.status === 20000 && data.message === "success") {
                                    alert("移除成功！");
                                    // 清空购物车信息
                                    $("#cart_content").empty();
                                    // 重新展示购物车信息
                                    showCart(_userId);
                                }
                            }
                        } else {
                            alert("移除失败");
                        }
                    }
                })
            }
        })
    }
</script>
</html>
